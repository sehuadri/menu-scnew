#!/bin/bash
clear
NC='\033[0m'

PERMISSION() {
    # Alamat URL lisensi disimpan dalam variabel agar mudah diubah
    local LICENSE_URL="https://raw.githubusercontent.com/sehuadri/scnew/main/ip-bot"
    
    # Dapatkan informasi IP dan tanggal saat ini
    local MYIP=$(curl -sS ipv4.icanhazip.com)
    local TODAY_DATE=$(date +'%Y-%m-%d')

    # Cari baris di mana kolom ke-4 cocok persis dengan MYIP.
    # Ini lebih akurat daripada grep dan menghilangkan kebutuhan cek kedua.
    local AUTHORIZED_ENTRY=$(curl -sS "$LICENSE_URL" | awk -v myip="$MYIP" '$4 == myip' | head -1)

    # Cek apakah IP ditemukan di kolom yang benar.
    if [[ -z "$AUTHORIZED_ENTRY" ]]; then
        echo -e "\033[1;91mPermission Denied (IP Not Registered)\033[0m"
        echo -e "\033[1;97mAkses Ditolak (IP Tidak Terdaftar)${NC}"
        read -n 1 -s -r -p "Press [ Enter ] to Exit"
        exit 1
    fi

    # Ekstrak hanya tanggal/status dari kolom ke-3.
    local EXP_STATUS=$(echo "$AUTHORIZED_ENTRY" | awk '{print $3}')

    # Lakukan perbandingan tanggal/status.
    if [[ "$EXP_STATUS" == "lifetime" ]]; then
        echo -e "\033[1;92mPermission Accepted (Lifetime User)\033[0m"
        echo -e "\033[1;97mAkses Diizinkan (Pengguna Lifetime)${NC}"
    elif [[ "$TODAY_DATE" < "$EXP_STATUS" ]]; then
        echo -e "\033[1;92mPermission Accepted\033[0m"
        echo -e "\033[1;97mAkses Diizinkan${NC}"
    elif [[ "$TODAY_DATE" == "$EXP_STATUS" ]]; then
        echo -e "\033[1;93mPermission Accepted (Today is Expiry Date)\033[0m"
        echo -e "\033[1;97mAkses Diizinkan (Hari Ini Kadaluarsa)${NC}"
    else
        echo -e "\033[1;91mPermission Denied (Expired)\033[0m"
        echo -e "\033[1;97mAkses Ditolak (Kadaluarsa)${NC}"
        read -n 1 -s -r -p "Press [ Enter ] to Exit"
        exit 1
    fi
}

# Contoh pemanggilan fungsi
PERMISSION
clear
greenBe="\033[5;32m"
# Mendapatkan tanggal dari server Google
dateFromServer=$(curl -sI --insecure https://google.com/ | grep -i '^date:' | sed -e 's/Date: //')
biji=$(date +"%Y-%m-%d" -d "$dateFromServer")

# Fungsi untuk mencetak teks berwarna merah
red() { 
    echo -e "\\033[91;1m${*}\\033[0m"
}

clear

fun_bar() {
    CMD[0]="$1"
    CMD[1]="$2"
    (
        [[ -e $HOME/fim ]] && rm $HOME/fim
        ${CMD[0]} -y >/dev/null 2>&1
        ${CMD[1]} -y >/dev/null 2>&1
        touch $HOME/fim
    ) >/dev/null 2>&1 &
    tput civis
    echo -ne "\033[0;33mPlease Wait Loading \033[1;37m- \033[0;33m["
    while true; do
        for ((i = 0; i < 15; i++)); do
            echo -ne "\033[0;32m#"
            sleep 0.1s
        done
        [[ -e $HOME/fim ]] && rm $HOME/fim && break
        echo -e "\033[0;33m]"
        sleep 1s
        tput cuu1
        tput dl1
        echo -ne "\033[0;33mPlease Wait Loading \033[1;37m- \033[0;33m["
    done
    echo -e "\033[0;33m]\033[1;37m -\033[1;32m OK !\033[1;37m"
    tput cnorm
}

clear
echo -e "\e[91;1mDelete Bot Regis IP\e[0m"

file_bot() {
    sleep 2
    
    systemctl stop vermilion

    rm -rf /root/vermilion.sh


    cd /usr/bin || exit
    rm -rf vermilion vermilion2 vermilion3 vermilion4 vermilion5 vermilion.zip vermilion.zip.1 vermilion.zip.2 vermilion.zip.3 vermilion.zip.4 vermilion.zip.5 vermilion2.zip vermilion2.zip.1 vermilion2.zip.2 vermilion2.zip.3 vermilion3.zip vermilion3.zip.1 vermilion3.zip.2 vermilion3.zip.3
    
}

fun_bar 'bot_file'
clear
echo -e "\e[5;32mSuccessfully Delete Bot Regis IP\e[0m"
sleep 1
read -n 1 -s -r -p "Press [ Enter ] to back on menu"
m-regis
